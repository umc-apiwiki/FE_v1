name: Vite CI

on:
  push:
    branches: [main] # ë©”ì¸ ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œ ì‹¤í–‰
  pull_request:
    branches: [main] # PRì´ ìƒì„±ë  ë•Œ ì‹¤í–‰

jobs:
  quality-checks:
    runs-on: ubuntu-latest

    steps:
      # 1. ì†ŒìŠ¤ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Node.js í™˜ê²½ ì„¤ì •
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm' # ìºì‹œë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¤ì¹˜ ì†ë„ í–¥ìƒ

      # 3. ì˜ì¡´ì„± ì„¤ì¹˜
      - name: Install dependencies
        run: npm ci # package-lock.jsonì„ ê¸°ì¤€ìœ¼ë¡œ ì—„ê²©í•˜ê²Œ ì„¤ì¹˜

      # 4. Prettier ê²€ì‚¬
      - name: Check Prettier format
        run: npm run format:check

      # 5. ESLint ê²€ì‚¬
      - name: Run ESLint
        run: npm run lint

      # 6. Vite ë¹Œë“œ í…ŒìŠ¤íŠ¸ (ì„ íƒ ì‚¬í•­ì´ì§€ë§Œ ê¶Œì¥)
      - name: Build project
        run: npm run build

      # 7. CI ì„±ê³µ ì•Œë¦¼
      - name: âœ… Send CI Success
        if: success()
        run: |
          curl -H "Content-Type: application/json" \
            -X POST \
            -d '{
              "embeds": [{
                "title": "âœ… CI ì²´í¬ ì™„ë£Œ!",
                "description": "Prettier, ESLint, Build ëª¨ë‘ í†µê³¼\nğŸ“ ${{ github.repository }}",
                "color": 65280,
                "fields": [{
                  "name": "ë¸Œëœì¹˜",
                  "value": "`${{ github.ref_name }}`",
                  "inline": true
                }, {
                  "name": "ì»¤ë°‹",
                  "value": "`${{ github.sha }}`",
                  "inline": true
                }],
                "timestamp": "${{ github.event.created_at }}"
              }]
            }' \
            ${{ secrets.DISCORD_WEBHOOK_URL }}

      # 8. CI ì‹¤íŒ¨ ì•Œë¦¼
      - name: âŒ Send CI Failure
        if: failure()
        run: |
          curl -H "Content-Type: application/json" \
            -X POST \
            -d '{
              "embeds": [{
                "title": "âŒ CI ì²´í¬ ì‹¤íŒ¨!",
                "description": "Prettier, ESLint, ë˜ëŠ” Build ë‹¨ê³„ì—ì„œ ì˜¤ë¥˜ ë°œìƒ\nğŸ“ ${{ github.repository }}",
                "color": 16711680,
                "fields": [{
                  "name": "ë¸Œëœì¹˜",
                  "value": "`${{ github.ref_name }}`",
                  "inline": true
                }, {
                  "name": "ì»¤ë°‹",
                  "value": "`${{ github.sha }}`",
                  "inline": true
                }],
                "timestamp": "${{ github.event.created_at }}"
              }]
            }' \
            ${{ secrets.DISCORD_WEBHOOK_URL }}
